generator client {
  provider     = "prisma-client"
  output       = "../generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        Int     @id @default(autoincrement())
  firstName String
  surname   String
  cpf       String  @unique
  password  String
  badge     Badge?  @relation(fields: [badgesKey], references: [key])
  badgesKey String?
  tables    Table[]
}

model Badge {
  id    Int    @id @default(autoincrement())
  name  String @unique
  key   String @unique
  users User[]
}

model Table {
  id            Int     @id @default(autoincrement())
  name          String  @unique
  key           String  @unique
  attendantUser User?   @relation(fields: [userId], references: [id])
  userId        Int?
  isBusy        Boolean @default(false)
  order         Order   @relation(fields: [orderId], references: [id])
  orderId       Int     @unique
}

model Order {
  id         Int          @id @default(autoincrement())
  name       String?
  key        String?
  tables     Table?
  items      OrderItems[]
  payment    PaymentType? @relation(fields: [paymentKey], references: [key])
  paymentKey String?
  createdAt  DateTime     @default(now())
  openedAt   DateTime?
  closedAt   DateTime?
  status     Status?      @relation(fields: [statusKey], references: [key])
  statusKey  String?
}

model OrderItems {
  id         Int      @id @default(autoincrement())
  orderId    Int
  productsId Int
  products   Products @relation(fields: [productsId], references: [id])
  quantity   Int
  order      Order    @relation(fields: [orderId], references: [id])
  createdAt  DateTime @default(now())
}

model Products {
  id             Int          @id @default(autoincrement())
  name           String       @unique
  key            String       @unique
  price          Decimal
  orderItems     OrderItems[]
  typeKey        ProductType  @relation(fields: [productTypeKey], references: [key])
  productTypeKey String
}

model ProductType {
  id       Int        @id @default(autoincrement())
  name     String     @unique
  key      String     @unique
  products Products[]
}

model PaymentType {
  id       Int     @id @default(autoincrement())
  name     String  @unique
  key      String  @unique
  products Order[]
}

model Status {
  id     Int     @id @default(autoincrement())
  name   String  @unique
  key    String  @unique
  orders Order[]
}
